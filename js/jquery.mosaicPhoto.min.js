/**
 * Class: mosaicPhoto
 * Use: insert preview photos mosaically into div
 * Author: Anton Syuvaev (http://h8every1.ru)
 * Company: Elustro (http://elustro.ru)
 * Date: 10.05.2012
 * Version: 1.0.2
 */
(function(c){var f=function(d,a){function g(){for(;1<a.ratio;)a.ratio/=100;var b=c('<div class="'+a.activeClass+'"/>').appendTo(j);q=b.outerWidth(!0);r=b.outerHeight(!0);t();u=Math.min(Math.floor(a.rows*a.cols*a.ratio),a.maxImages);f(o);y();z();A()}function f(a){if(!a||!k.hasOwnProperty(a)||"object"!==typeof k[a])a:{for(var c in k)if(k.hasOwnProperty(c)){a=c;break a}alert("No image data!");a=null}o=a}function t(){if(!a.dynamic)return!0;var b=Math.floor(j.width()/q),c=Math.floor(j.height()/r);return c!==
    a.rows||b!==a.cols?(a.rows=c,a.cols=b,!0):!1}function m(){var b=Math.min(u,k[o].length);if(!b)return!1;for(var d=v(k[o],b),l=[],h=a.rows*a.cols,i=0;i<h;i++)l[i]=i;for(var l=v(l,b).sort(function(a,b){return a-b}),b=0,e=l.shift(),h=d.shift(),f="",i=0;i<a.rows;i++)for(var g=0;g<a.cols;g++)if(l.length)b===e&&(e="object"===typeof h,f+='<div class="'+a.activeClass+'" style="top:'+i*r+"px;left:"+g*q+"px;background-image:url("+(e?h[0]:h)+')">'+(e&&h[1]?'<a href="'+h[1]+'"></a>':"")+"</div>",e=l.shift(),h=
    d.shift()),b++;else break;j.html("");c(f).appendTo(j).fadeIn(a.fadeTime);a.showAllCallback();return!0}function y(){p.unbind("resize"+e);a.dynamic&&p.bind("resize"+e,function(){if(t())return m()})}function z(){w.undelegate(a.listenersEvents+e);x=c(a.listeners);x.length&&w.delegate(a.listeners,a.listenersEvents+e,function(b){f(c(this).attr("rel"));m();a.listenerCallback();return b.preventDefault()}).delegate(a.listeners,"click"+e,function(a){return a.preventDefault()})}function A(){n&&clearInterval(n);
    a.auto&&(n=setInterval(function(){return m()},a.timer+a.fadeTime))}function v(a,c){for(var e=[],d=a.slice();d.length;)e.push(d.splice(Math.random()*d.length,1)[0]);return e.slice(0,c)}var s=this,p=c(window),w=c(document),j=c('<div style="height:100%;position:relative"></div>').appendTo(d),k=a.images,u,o,q=0,r=0,n,x,e=".mosaicphoto"+(new Date).getTime();this.getOptions=function(b){return"undefined"===typeof b?a:a[b]};this.setOptions=function(b){p.undelegate(a.listenersEvents+e);c.extend(a,b);g();return s};
    this.selectCategory=function(a){f(a);return s};this.refresh=function(){m();return s};this.destroy=function(){p.undelegate(e);n&&clearInterval(n);j.remove();d.removeData("mosaicphoto");return d};g();m()};f.defaults={rows:3,cols:8,ratio:0.8,maxImages:24,dynamic:!0,activeClass:"mosaicItem",fadeTime:750,auto:!1,timer:3E3,images:{},listeners:"",listenersEvents:"click",showAllCallback:function(){},listenerCallback:function(){}};c.fn.mosaicPhoto=function(d){var a=this.data("mosaicphoto");if(a)return"object"===
    typeof d&&a.setOptions(d),a;d=c.extend({},f.defaults,d);this.each(function(){var g=c(this);a=new f(g,d);g.data("mosaicphoto",a)});return this}})(jQuery);